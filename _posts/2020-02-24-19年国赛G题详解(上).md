---
layout:     post
title:      19年国赛G题详解（上）
subtitle:   双路语音调频收发机 之 发射机
date:       2020-02-24
author:     Sterben
header-img: img/post-bg-1.jpg
catalog: true
tags:
    - fpga项目
---
## 前言不多说上代码

[Two-way-transmitter](https://github.com/Bestduan/Two-way-transmitter)

## 方案阐述

对于这道题如果使用数字方案的话较大的难点就是如何输出射频调制信号，毕竟高速DAC是很难获得的，现在市场上学生能买得起的高速DAC也就只有黑金，但是在这里125M/s的采样输出对于48.5M的载波来说还是很难实现的，但是考虑到是调频信号，发射出去的只是频率信息，因此幅度信息什么的就不重要了，于是我们可以直接选用IO口来进行调制信号的输出，一方面输出的幅度大，一方面实现简单。具体流程见下图

![发射机结构框图](https://i.loli.net/2020/02/28/Dnm694X3kh1Y2ze.png)

### 双路语音的采集

由于是数字方案，所以语音信号的采集还是需要ADC的，这里可以选用一般声卡芯片，也可以使用ADC音频采集芯片，由于我之前就买过黑金的AN9226模块，于是我这里就直接拿过来做音频采集了。其实在这里我比较建议使用黑金AD7606采集卡。[AD7606](https://item.taobao.com/item.htm?spm=a1z10.5-c-s.w4002-21639808658.27.7945402b2hxZ6X&id=45306015885)因为对于音频采集没必要用到像AN9226那么高的采样率

### 双路语音的合成

双路语音的合成是这道题的第二个难点，因为他牵扯到双路语音的分解，无论是AM合成还是DSB合成在接收机那都要分解出来，在专业FM广播电台里使用的是DSB加导频的方案，其实这个本质上和AM差不多，重点是导频插在哪，这里为了方便就直接选用AM调制来实现双路语音的合成，这样选择有一个好处，那就是在之后的数字IQ解调时不需要进行载波同步。那么这里就涉及到[AM调制的FPGA的实现](https://blog.csdn.net/HOOKNET/article/details/79129451)。我在这里就不详细说明了。这个博客写的挺好的，但是使用IP核的方式我不能苟同，因为这会导致之后项目移植的困难，在我看来一些小的简单的模块实现还是自己写好时刻备着比较好，因为之后会接触到很多不同平台的fpga，一个一个地去学就太麻烦了。所以在这里我贴上我自己的AM的纯Verilog实现[AM_Module](https://github.com/Bestduan/Two-way-transmitter/blob/master/Match_C.srcs/sources_1/new/AM_Module.v)。

### 双路语音的调制

得到合成好的信号之后就可以送到FM调制模块去调制了。同样的在这里废话不多说[FM_Module](https://github.com/Bestduan/Two-way-transmitter/blob/master/Match_C.srcs/sources_1/new/FM_Module.v)在这里输出的就是FM的信号了，但是是用正弦来表示的，之前说过由于高速AD的难以获取选用IO来输出，因此只需要将输出的正弦信号的最高位拉出来送到fpga的io口上即可，详见TOP.V。

## 发射机的前端模拟设计

有一说一，这一部分其实是整个题最难受的部分，因为题目要求天线长度不能超过50cm，完全达不到48.5M信号波长的四分之一。当然这个有最方便的解决方案，那就是氪金。买一个射频功放**做好散热**还是能强行将信号推到2m的距离。

当然我作为一个穷学生，氪金是不可能的，而且这个只是最方便的方案而不是最好的，因为你买回来的功放和你的天线根本不会匹配，能发射出去能量的微乎其微，我曾拿过我当时用的拉杆天线到学校的仪器室里使用矢量网络分析仪测量过他在48.5M的驻波比，结果是全反射，就是说在这个频段根本发射不出去。既然能量没有发射出去他就会原路返回从而烧坏前端功放。

### 模拟前端设计所需的软件

Advanced Design System (ADS) 16.01

Altium Designer (AD) 18.1

### 模拟前端设计所需的材料

AH101-G * 1

ADL5536 * 2

电容电感若干（注：这里的电感建议0603的村田射频绕线电感）

### 模拟前端设计所需的仪器

200M带宽以上的示波器

频谱分析仪

函数发生器

矢量网络分析仪

### 模拟前端设计过程

由之前的设计我们已经得到从fpga的IO端口输出端的调频脉冲，现在我们要将48.5M的这个频段滤出来，将干净的信号送到前面的射频放大器，由于48.5M不是一个特殊的频点，所以我们要使用Advanced Design System来设计LC带通滤波器，在这里我就不详细说明ADS的[安装教程](https://www.jb51.net/softjc/632231.html)和[使用教程](http://www.mweda.com/Agilent/Agilent_384.html)了。设计好LC带通滤波器之后将参数保存，从而购买相应容感值的LC。

完成LC带通滤波器的设计之后，再完成天线端的阻抗匹配。要想完成阻抗匹配，首先要知道天线的阻抗是多少，这时候就要用到矢量网络分析仪来[测量天线的阻抗](http://www.antenna-theory.com/cn/measurements/impedance.php)。记录下天线的复数阻抗。

拿到天线的复数阻抗后就可以使用ADS开始[天线阻抗的匹配设计](https://wenku.baidu.com/view/fa7356282af90242a895e586.html)。(注：在设计过程中会选择匹配网络形式，这时候你选择的形式是按照你输出信号来看的，像我设计的时候输出信号有比较大的低频噪声，所以我最后选用的就是高通形式来做匹配设计)。

拿到设计参数后就可以使用AD画板啦，将器件布局到板子上，画好之后送到工厂里打板就ok了。

到此整个发射机的设计就结束了。过程比较简单，毕竟是在家里写的，仪器材料啥的没有办法截图，之后有时间的话再补充吧。
